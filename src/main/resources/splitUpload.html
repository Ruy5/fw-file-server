<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chunked File Upload</title>
</head>
<body>
<h1>Chunked File Upload</h1>
<input type="file" id="fileInput" />
<button onclick="uploadFile()">Upload</button>
<div id="progressContainer">
  <progress id="uploadProgress" value="0" max="100"></progress>
  <span id="progressText">0%</span>
</div>
<div id="status"></div>

<script>
  const CHUNK_SIZE = 1024 * 1024; // 1MB

  function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) {
          alert('Please select a file');
          return;
      }

      const file = fileInput.files[0];
      const totalChunks = Math.ceil(file.size / CHUNK_SIZE);
      let currentChunk = 0;

      const uploadChunk = () => {
          const start = currentChunk * CHUNK_SIZE;
          const end = Math.min(start + CHUNK_SIZE, file.size);
          const chunk = file.slice(start, end);

          const formData = new FormData();
          formData.append('file', chunk);
          formData.append('chunkNumber', currentChunk);
          formData.append('totalChunks', totalChunks);
          formData.append('identifier', file.name);

          const xhr = new XMLHttpRequest();
          xhr.open('POST', 'http://localhost:1024/upload/chunk', true);

          xhr.onload = function() {
              if (xhr.status === 200) {
                  currentChunk++;
                  const progress = Math.round((currentChunk / totalChunks) * 100);
                  document.getElementById('uploadProgress').value = progress;
                  document.getElementById('progressText').innerText = progress + '%';

                  if (currentChunk < totalChunks) {
                      uploadChunk();
                  } else {
                      document.getElementById('status').innerText = 'Upload complete';
                  }
              } else {
                  document.getElementById('status').innerText = 'Error uploading chunk ' + currentChunk;
              }
          };

          xhr.onerror = function() {
              document.getElementById('status').innerText = 'Error uploading chunk ' + currentChunk;
          };

          xhr.send(formData);
      };

      uploadChunk();
  }
</script>
</body>
</html>
